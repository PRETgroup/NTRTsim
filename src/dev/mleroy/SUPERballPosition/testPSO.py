# -*- coding: utf-8 -*-
from pyswarm import pso
import subprocess
import numpy as np

def banana(x):
	x1=x[0]
	x2=x[1]
	#though it checks that no error is generated, i.e. return=0, x saves the console output string
	#x = subprocess.check_output(["./testcpp","%f" % x1,"%f" % x2]) 
	'''
	x = subprocess.check_output([appFile,yamlFile])
	x = x[:-1]
	xa,xb = x.split(" ")
	xa=float(xa)
	xb=float(xb)
	'''
	return x1**4 - 2*x2*x1**2 + x2**2 + x1**2 - 2*x1 + 5
	#return x1 + x2

'''
def con(x):
	x1=x[0]
	x2=x[1]
	return [-(x1 + 0.25)**2 + 0.75*x2]
'''

lb=[-3, -1]
ub=[2, 6]

appFile = "../projects/NTRTsim/build/dev/mleroy/SUPERballPosition/AppSUPERballPosition"
yamlFile = "../projects/NTRTsim/resources/YamlStructures/SUPERballV2.yaml"
randVar = np.random.rand(1,1)
print(randVar)

'''
xopt, fopt = pso(banana, lb, ub, f_ieqcons=con)
print xopt
print fopt
'''

xopt2, fopt2 = pso(banana, lb, ub, f_ieqcons=None, args=(), kwargs={}, swarmsize=100, omega=0.5, phip=0.5, phig=0.5, maxiter=100, minstep=1e-8, minfunc=1e-8, debug=True)
print xopt2
print fopt2
# Optimum should be around x=[0.5, 0.76] with banana(x)=4.5 and con(x)=0


#0. 0. 1. 0. 1. 1. 1. 1. 0.14435705 1. 0.81898527 0.17209742 1. 0. 0. 1. 0. 0.54530238 1. 0. 0.6963873 1. 1. 1. 0. 0.19754744 1. 0. 1. 0. 0. 1. 34.144
#1. 0.16677755 0. 0. 1. 1. 0. 1. 1. 0.69820828  0. 1. 0.54239054 0. 0.02588343 0. 1. 0.48075941 0.25993709 0. 0.99540389 0.1697699 1. 1. 1. 0.12903548 0. 1. 1. 1. 0.32325935 0.64040165 108.87
#1.          0.6262526   0.          0.          1.          1.          0.  1.          1.          0.72101176  0.          1.          0.742656    0.  0.02142263  0.          1.          0.2640227   0.36196229  0.  0.96189769  0.03395976  1.          1.          1.          0.10194303  0.          1.          1.          1.          0.25040087  0.58259966 117.01
#1.          0.          0.06844517  0.          1.          0.87983098 0.          1.          1.          0.73456144  0.          1. 0.65070092  0.          0.07458942  0.          1.          0.11300696 0.37929272  0.          1.          0.0391356   0.81428885  1.          1. 0.14547685  0.          1.          0.89841268  1.          0.3043344 0.50035275 117.23
#1.          0.17353201  0.          0.          0.9565951   0.9571211  0.10140955  1.          0.92766767  0.34684472  0.          0.98219464  0.66950449  0.          0.05166109  0.          1.          0.12701874  0.52230839  0.          1.          0.          0.67461335  1.  0.94888317  0.0610095   0.          0.85475147  0.96992792  1.  0.32942124  0.72215045] -121.24
#1.          0.29496674  0.0181974   0.          0.99089794  0.93763829  0.01323499  1.          0.92934525  0.40309917  0.          1.  0.58397592  0.          0.00565995  0.          1.          0.13377377  0.50168348  0.          1.          0.          0.52310711  1.          0.9121773  0.          0.          1.          0.98999584  1.          0.3634237  0.62561814] -123.88
#1.00000000e+00   2.82219844e-01   0.00000000e+00   0.00000000e+00   1.00000000e+00   9.54337723e-01   0.00000000e+00   1.00000000e+00   9.17262294e-01   4.06479804e-01   0.00000000e+00   1.00000000e+00   5.65745607e-01   0.00000000e+00   6.91987301e-04   0.00000000e+00   1.00000000e+00   1.42717099e-01   5.08552824e-01   0.00000000e+00   1.00000000e+00   0.00000000e+00   4.47764570e-01   1.00000000e+00   8.82082982e-01   0.00000000e+00   0.00000000e+00   9.77676577e-01   1.00000000e+00   1.00000000e+00   4.75729310e-01   5.76797552e-01] -126.37
#1.          0.          0.          0.          1.          1.  0.14494918  1.          0.93838939  0.57438006  0.          0.99759764  0.84460343  0.02577247  0.          0.          1.          0.47811089  0.54785055  0.00153608  0.99321363  0.          0.38189399  1.  0.87748229  0.02297417  0.          0.95461916  1.          0.89493806  0.09580656  0.49503147] -127.56
#1.00000000e+00   0.00000000e+00   2.61678575e-04   0.00000000e+00   1.00000000e+00   1.00000000e+00   2.32098177e-01   1.00000000e+00   9.48523025e-01   4.23896373e-01   0.00000000e+00   1.00000000e+00   8.36750647e-01   0.00000000e+00   0.00000000e+00   0.00000000e+00   1.00000000e+00   2.03363234e-01   5.29449622e-01   0.00000000e+00   1.00000000e+00   0.00000000e+00   4.61457165e-01   1.00000000e+00   8.85431222e-01   2.03416999e-02   0.00000000e+00   1.00000000e+00   1.00000000e+00   9.95060912e-01   1.74238142e-01   8.55226429e-01]-127.59
